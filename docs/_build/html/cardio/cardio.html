
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cardio &#8212; CSD3 0.1 documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="cardio">
<h1><em>Cardio</em><a class="headerlink" href="#cardio" title="Permalink to this headline">¶</a></h1>
<p>Cardio is the HPC facility at the CEU..</p>
<div class="section" id="csd3-partition">
<h2>CSD3 partition<a class="headerlink" href="#csd3-partition" title="Permalink to this headline">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>scontrol show part
<span class="c1"># cpu-o-1 for interactive jobs with no limit on cpus per user expecting fair usage</span>
<span class="c1"># cpu-o-[2-5] for long jobs with maximum cpus per user set to 40 and a maximum wall time of 7 days</span>
<span class="c1"># cpu-o-7 for short jobs with a maximum wall time of 24 hours</span>

<span class="c1"># Interactive jobs</span>

<span class="c1">#SBATCH -A CARDIO-SL0-CPU</span>
<span class="c1">#SBATCH -p cardio_intr</span>
<span class="c1">#SBATCH --qos=cardio_intr</span>

<span class="c1"># Long jobs</span>

<span class="c1">#SBATCH -A CARDIO-SL0-CPU</span>
<span class="c1">#SBATCH -p cardio</span>
<span class="c1">#SBATCH --qos=cardio</span>

<span class="c1"># Short jobs</span>

<span class="c1">#SBATCH -A CARDIO-SL0-CPU</span>
<span class="c1">#SBATCH -p cardio_short</span>
<span class="c1">#SBATCH --qos=cardio_short</span>
</pre></div>
</div>
</div>
<div class="section" id="login">
<h2>login<a class="headerlink" href="#login" title="Permalink to this headline">¶</a></h2>
<p>Automatic login can be enabled with <code class="docutils literal notranslate"><span class="pre">ssh-copy-id</span> <span class="pre">cardio-login.hpc.cam.ac.uk</span></code>.</p>
</div>
<div class="section" id="migration">
<h2>Migration<a class="headerlink" href="#migration" title="Permalink to this headline">¶</a></h2>
<p>It is possible to fetch <code class="docutils literal notranslate"><span class="pre">my-file-on-Cardio</span></code> with</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>scp cardio-login.hpc.cam.ac.uk:/home/<span class="nv">$USER</span>/my-file-on-Cardio .
</pre></div>
</div>
<p>as with <code class="docutils literal notranslate"><span class="pre">sftp</span></code>, noting the <code class="docutils literal notranslate"><span class="pre">-r</span></code> option for both could be very useful. More generally, it is preferable to use <code class="docutils literal notranslate"><span class="pre">rsync</span></code>, <a class="reference external" href="https://rsync.samba.org/">https://rsync.samba.org/</a>.</p>
<p>Old version on Cardio, rsync 3.0.6, gives errors,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rsync -av --partial mydir/ login-cpu.hpc.cam.ac.uk:/rds/user/<span class="nv">$USER</span>/hpc-work/mydir

Errors after successfully sending a number of files : 
rsync: writefd_unbuffered failed to write <span class="m">4</span> bytes to socket <span class="o">[</span>sender<span class="o">]</span>: Broken pipe <span class="o">(</span><span class="m">32</span><span class="o">)</span>
rsync: connection unexpectedly closed <span class="o">(</span><span class="m">604</span> bytes received so far<span class="o">)</span> <span class="o">[</span>sender<span class="o">]</span>
rsync error: error in rsync protocol data stream <span class="o">(</span>code <span class="m">12</span><span class="o">)</span> at io.c<span class="o">(</span><span class="m">600</span><span class="o">)</span> <span class="o">[</span><span class="nv">sender</span><span class="o">=</span><span class="m">3</span>.0.6<span class="o">]</span>
</pre></div>
</div>
<p>Bram Prins (<a class="reference external" href="mailto:bp406&#37;&#52;&#48;medschl&#46;cam&#46;ac&#46;uk">bp406<span>&#64;</span>medschl<span>&#46;</span>cam<span>&#46;</span>ac<span>&#46;</span>uk</a>) has the latest version (3.1.3) that doesn’t give this error here:</p>
<p>/DO-NOT-MODIFY-SCRATCH/bp406/apps/software/data_manipulation/rsync-3.1.3/rsync</p>
<p>Note <strong>/scratch</strong> at Cardio is now <strong>/DO-NOT-MODIFY-SCRATCH</strong> – an example is <a class="reference external" href="files/jp.sh">jp.sh</a>.</p>
</div>
<div class="section" id="r-package-reinstallations">
<h2>R package reinstallations<a class="headerlink" href="#r-package-reinstallations" title="Permalink to this headline">¶</a></h2>
<p>Package redeployment is illustrated with R below for building R package list from <em><strong>/home/$USER/R</strong></em> at Cardio to be resintalled to <em><strong>/rds/user/$USER/hpc-work/R</strong></em> at CSD3.</p>
<p>We can use screen copy of package list from Cardio since users do not have write permission.</p>
<p><strong>On Cardio</strong></p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span>  <span class="n">home</span> <span class="o">&lt;-</span> <span class="nf">Sys.getenv</span><span class="p">(</span><span class="s">&quot;HOME&quot;</span><span class="p">)</span>
  <span class="n">from</span> <span class="o">&lt;-</span> <span class="nf">paste0</span><span class="p">(</span><span class="n">home</span><span class="p">,</span><span class="s">&quot;/R&quot;</span><span class="p">)</span>
  <span class="n">pkgs</span> <span class="o">&lt;-</span> <span class="nf">unname</span><span class="p">(</span><span class="nf">installed.packages</span><span class="p">(</span><span class="n">lib.loc</span> <span class="o">=</span> <span class="n">from</span><span class="p">)[,</span> <span class="s">&quot;Package&quot;</span><span class="p">])</span>
  <span class="nf">edit</span><span class="p">(</span><span class="n">pkgs</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>On CSD3</strong></p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span>  <span class="n">pkgs</span> <span class="o">&lt;-</span> <span class="s">&quot;mark and copy the list as given in c() above with Shift+Ins&quot;</span>
  <span class="n">user</span> <span class="o">&lt;-</span> <span class="nf">Sys.getenv</span><span class="p">(</span><span class="s">&quot;USER&quot;</span><span class="p">)</span>
  <span class="n">to</span> <span class="o">&lt;-</span> <span class="nf">paste0</span><span class="p">(</span><span class="s">&quot;/rds/user/&quot;</span><span class="p">,</span><span class="n">user</span><span class="p">,</span><span class="s">&quot;/hpc-work/R&quot;</span><span class="p">)</span>
  <span class="nf">install.packages</span><span class="p">(</span><span class="n">pkgs</span><span class="p">,</span> <span class="n">lib</span><span class="o">=</span><span class="n">to</span><span class="p">,</span> <span class="n">repos</span><span class="o">=</span><span class="s">&quot;https://cran.r-project.org&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>If a package list is already built one can reinstall them as follows.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">user</span> <span class="o">&lt;-</span> <span class="nf">Sys.getenv</span><span class="p">(</span><span class="s">&quot;USER&quot;</span><span class="p">)</span>
<span class="n">location</span> <span class="o">&lt;-</span> <span class="nf">paste0</span><span class="p">(</span><span class="s">&quot;/rds/user/&quot;</span><span class="p">,</span><span class="n">user</span><span class="p">,</span><span class="s">&quot;/hpc-work/R&quot;</span><span class="p">)</span>
<span class="n">pkgs</span> <span class="o">&lt;-</span> <span class="nf">unname</span><span class="p">(</span><span class="nf">installed.packages</span><span class="p">(</span><span class="n">lib.loc</span> <span class="o">=</span> <span class="n">location</span><span class="p">)[,</span> <span class="s">&quot;Package&quot;</span><span class="p">])</span>
<span class="nf">install.packages</span><span class="p">(</span><span class="n">pkgs</span><span class="p">,</span> <span class="n">lib</span><span class="o">=</span><span class="n">location</span><span class="p">,</span> <span class="n">repos</span><span class="o">=</span><span class="s">&quot;https://cran.r-project.org&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>A version by Scott Ritchie (<a class="reference external" href="mailto:sr827&#37;&#52;&#48;medschl&#46;cam&#46;ac&#46;uk">sr827<span>&#64;</span>medschl<span>&#46;</span>cam<span>&#46;</span>ac<span>&#46;</span>uk</a>), <a class="reference external" href="cardio/reinstall_r_pkgs.R">reinstall_r_pkgs.R</a>, also touches upon Bioconductor,
whose package installations and updates are described at <a class="reference external" href="https://bioconductor.org/install/">https://bioconductor.org/install/</a>.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">CSD3</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Jing Hua Zhao.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.4.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/cardio/cardio.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>